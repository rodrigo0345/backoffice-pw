import{A as te,i as _}from"./index-DMAR3cfG.js";import{U as ae}from"./UserService-CGgb5RKk.js";import{r as E,_ as oe,l as v,k as t,i as a,w as o,p as Q,q as U,F as T,m as W,f as w,g as n,j as C,t as y,e as A,v as le,x as se}from"./index-h_cMowcx.js";import"./RepositoryInterface-TDgCEybl.js";const k=new ae,re={components:{AppModal:te},data(){return{selectedRole:""}},setup(){const I=E([]),s=E(1),j=E(""),e="adduser",g=E({isDeleted:!1}),h=E(null),x=E(0),b=E("ola");function p(r){const u=k.getUserJob(r.id);h.value={...r,job:u}}async function c(){I.value=k.listUsers(g.value).filter(r=>j.value.trim()===""?!0:r.email.includes(j.value)||r.name.includes(j.value)).filter((r,u)=>u>=(s.value-1)*10&&u<s.value*10)}async function G(r){r.orderKey===g.value.orderKey&&(r.orderBy=g.value.orderBy==="asc"?"desc":"asc"),g.value={...g.value,...r},await c()}async function B(r){j.value=r,await c()}async function K(){g.value={isDeleted:!1},await c()}async function P(){s.value++,await c()}async function M(){s.value--,await c()}async function q(r){r<1&&(r=1),s.value=r,await c()}c();function R(r){return new Promise((u,m)=>{const f=new FileReader;f.onload=function(){u(f.result)},f.onerror=m,f.readAsDataURL(r)})}async function l(){const r=document.getElementById("user-name"),u=document.getElementById("user-email"),m=document.getElementById("user-role"),f=document.getElementById("user-image"),V=document.getElementById("user-password"),D=document.getElementById("user-job");if(console.log({job:D.value}),!r||!u||!m||!f||!V){_("Please fill all the fields",{type:"error"});return}if(!r.value||!u.value||!m.value||!f.value||!V.value){_("Please fill all the fields",{type:"error"});return}if(m.value==="Role"){_("Please select a role",{type:"error"});return}if(m.value==="worker"&&D.value=="0"){_("Please select a job",{type:"error"});return}const L=m.value,N={email:u.value,name:r.value,id:0,role:L,isDeleted:!1,password:V.value,jobId:0,photoUrl:await R(f.files[0])};try{k.createUser(N),k.addJobToUser(N.id,Number(D.value))}catch(S){_(S.message,{type:"error"});return}document.getElementById("close-modal-"+e).click(),_("User created",{type:"success"}),await q(1),await c()}async function d(r){try{k.deleteUser(r),await c(),_("User deleted",{type:"success"})}catch(u){_("Error deleting user: "+u.message,{type:"error"})}}async function J(){var z,H,O,X,Y,Z;const r=document.getElementById("user-name-edit"),u=document.getElementById("user-email-edit"),m=document.getElementById("user-role-edit"),f=document.getElementById("user-image-edit"),V=document.getElementById("user-password-edit"),D=document.getElementById("user-delete-edit"),L=document.getElementById("user-job-edit"),N=D?D.checked:!0;if(!h.value){_("Error editing user: User not found",{type:"error"});return}let F=((z=h.value)==null?void 0:z.photoUrl)||"";try{F=await R(f.files[0])||F}catch{F=((H=h.value)==null?void 0:H.photoUrl)||""}if((m==null?void 0:m.value)==="worker"&&L.value=="0"){_("Please select a job",{type:"error"});return}const S={...h.value,name:r.value||((O=h.value)==null?void 0:O.name)||"default",email:u.value||((X=h.value)==null?void 0:X.email)||"default",role:(m==null?void 0:m.value)??((Y=h.value)==null?void 0:Y.role),photoUrl:F,password:V.value||((Z=h.value)==null?void 0:Z.password),isDeleted:!N};if(!S.id){_("Error editing user: User id not found",{type:"error"});return}try{k.updateUser(S.id,S),L.value!="0"&&k.addJobToUser(S.id,Number(L.value)),await c(),_("User edited",{type:"success"})}catch($){_("Error editing user: "+$.message,{type:"error"});return}document.getElementById("close-modal-"+e+"-edit").click()}const ee=k.getAllAvailableJobs({});return{editedRole:b,modalId:"adduser",userService:k,createWithSelectedJob:x,document,deleteUser:d,availableJobs:ee,users:I,createUser:l,nextPage:P,previousPage:M,setPage:q,page:s,setQuery:G,resetQuery:K,query:g,setSearch:B,setEditUser:p,editedUser:h,editUser:J}}},i=I=>(le("data-v-ede5d702"),I=I(),se(),I),de={class:"intro"},ie={class:"bg-image h-100"},ne={class:"mask d-flex align-items-center h-100"},ce={class:"container"},ue={class:"row justify-content-center"},me={class:"col-12"},_e={class:"d-flex align-items-center mb-3 gap-3 justify-content-between"},ve=i(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[t("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"})],-1)),ge={class:"card shadow-2-strong"},he={class:"card-body"},be={class:"table-responsive"},pe={class:"table table-borderless mb-0"},ye={scope:"col"},fe=i(()=>t("p",{class:"p-0 m-0"},"Name",-1)),we=i(()=>t("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Ce=[we],xe={scope:"col"},Ue=i(()=>t("p",{class:"p-0 m-0"},"Email",-1)),ke=i(()=>t("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Ie=[ke],Be=i(()=>t("th",{scope:"col"},"Role",-1)),Ee={scope:"col"},Ae=i(()=>t("p",{class:"p-0 m-0"},"Id",-1)),Pe=i(()=>t("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),De=[Pe],Se=i(()=>t("th",{scope:"col"},"Photo",-1)),je={key:0,scope:"col"},Re=["onClick"],Ve=["data-bs-target"],Le=["data-bs-target"],Fe=["data-bs-target"],Me=["data-bs-target"],qe=["data-bs-target"],Je=["src"],Ne={key:0,class:"custom-row"},Ge=["onClick"],Ke=i(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x text-white",viewBox:"0 0 16 16"},[t("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"})],-1)),Qe=[Ke],Te={class:"container d-flex pt-4 justify-content-between"},We=i(()=>t("span",{"aria-hidden":"true"},"«",-1)),ze=i(()=>t("span",{"aria-hidden":"true"},"»",-1)),He=i(()=>t("option",null,"Role",-1)),Oe=i(()=>t("option",{value:"worker"},"Worker",-1)),Xe=i(()=>t("option",{value:"admin"},"Admin",-1)),Ye=["value"],Ze=i(()=>t("div",null,null,-1)),$e=i(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"13",fill:"currentColor",class:"bi bi-person-fill",viewBox:"0 0 16 16"},[t("path",{d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})],-1)),et=["value"],tt=i(()=>t("option",{value:"worker"},"worker",-1)),at=i(()=>t("option",{value:"admin"},"admin",-1)),ot=["value"],lt=["value"],st=i(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"13",fill:"currentColor",class:"bi bi-key",viewBox:"0 0 16 16"},[t("path",{d:"M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8m4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5"}),t("path",{d:"M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})],-1));function rt(I,s,j,e,g,h){var R;const x=w("CInputGroupText"),b=w("CFormInput"),p=w("CInputGroup"),c=w("CButton"),G=w("CButtonGroup"),B=w("CPaginationItem"),K=w("CPagination"),P=w("CFormSelect"),M=w("app-modal"),q=w("CFormCheck");return n(),v("section",de,[t("div",ie,[t("div",ne,[t("main",ce,[t("div",ue,[t("div",me,[t("div",_e,[a(p,{class:"w-25"},{default:o(()=>[a(x,null,{default:o(()=>[ve]),_:1}),a(b,{onChange:s[0]||(s[0]=l=>e.setSearch(l.target.value)),placeholder:"Search","aria-label":"Search","aria-describedby":"search"})]),_:1}),a(G,{role:"group","aria-label":"Basic example"},{default:o(()=>[a(c,{color:"primary",active:!e.query.isDeleted,onClick:s[1]||(s[1]=l=>e.setQuery({isDeleted:!1}))},{default:o(()=>[C("Active")]),_:1},8,["active"]),a(c,{color:"primary",active:e.query.isDeleted,onClick:s[2]||(s[2]=l=>e.setQuery({isDeleted:!0}))},{default:o(()=>[C("Deleted")]),_:1},8,["active"])]),_:1})]),t("div",ge,[t("div",he,[t("div",be,[t("table",pe,[t("thead",null,[t("tr",null,[t("th",ye,[t("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:s[3]||(s[3]=l=>e.setQuery({orderKey:"name",orderBy:"asc"}))},[fe,(n(),v("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:Q({transform:e.query.orderKey==="name"&&e.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Ce,4))])]),t("th",xe,[t("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:s[4]||(s[4]=l=>e.setQuery({orderKey:"email",orderBy:"asc"}))},[Ue,(n(),v("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:Q({transform:e.query.orderKey==="email"&&e.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Ie,4))])]),Be,t("th",Ee,[t("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:s[5]||(s[5]=l=>e.setQuery({orderKey:"id",orderBy:"asc"}))},[Ae,(n(),v("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:Q({transform:e.query.orderKey==="id"&&e.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},De,4))])]),Se,e.query.isDeleted?U("",!0):(n(),v("th",je,"Delete"))])]),t("tbody",null,[(n(!0),v(T,null,W(e.users,l=>(n(),v("tr",{key:l.id,onClick:d=>e.setEditUser(l),class:"table-row custom-row-parent"},[t("td",{class:"custom-row","data-bs-toggle":"modal","data-bs-target":"#"+e.modalId+"-edit"},y(l.name),9,Ve),t("td",{class:"custom-row","data-bs-toggle":"modal","data-bs-target":"#"+e.modalId+"-edit"},y(l.email),9,Le),t("td",{class:"custom-row","data-bs-toggle":"modal","data-bs-target":"#"+e.modalId+"-edit"},y(l.role),9,Fe),t("td",{class:"custom-row","data-bs-toggle":"modal","data-bs-target":"#"+e.modalId+"-edit"},y(l.id),9,Me),t("td",{class:"custom-row","data-bs-toggle":"modal","data-bs-target":"#"+e.modalId+"-edit"},[t("img",{src:l.photoUrl,alt:"User photo",class:"bg-white",style:{"min-height":"40px",height:"40px",width:"40px","max-width":"40px",overflow:"hidden","border-radius":"50%","object-fit":"cover"}},null,8,Je)],8,qe),l.isDeleted?U("",!0):(n(),v("td",Ne,[t("button",{type:"button",class:"btn btn-danger btn-sm px-3",onClick:d=>e.deleteUser(l.id)},Qe,8,Ge)]))],8,Re))),128))])])])])])])]),t("div",Te,[a(K,{"aria-label":"Page navigation example"},{default:o(()=>[e.page>1?(n(),A(B,{key:0,"aria-label":"Previous",style:{cursor:"pointer"},onClick:e.previousPage},{default:o(()=>[We]),_:1},8,["onClick"])):U("",!0),a(B,{active:""},{default:o(()=>[C(y(e.page),1)]),_:1}),e.users.length==10?(n(),A(B,{key:1,onClick:s[6]||(s[6]=l=>e.setPage(e.page+1)),style:{cursor:"pointer"}},{default:o(()=>[C(y(e.page+1),1)]),_:1})):U("",!0),e.users.length==10?(n(),A(B,{key:2,onClick:s[7]||(s[7]=l=>e.setPage(e.page+2)),style:{cursor:"pointer"}},{default:o(()=>[C(y(e.page+2),1)]),_:1})):U("",!0),e.users.length==10?(n(),A(B,{key:3,"aria-label":"Next",onClick:e.nextPage,style:{cursor:"pointer"}},{default:o(()=>[ze]),_:1},8,["onClick"])):U("",!0)]),_:1}),a(c,{"data-bs-toggle":"modal",type:"button","data-bs-target":"#"+e.modalId,color:"primary"},{default:o(()=>[C(" Add new user ")]),_:1},8,["data-bs-target"]),a(M,{targetId:e.modalId,title:"Add User",description:"Create a new user",saveAction:e.createUser},{default:o(()=>[a(p,{class:"mb-3"},{default:o(()=>[a(x,null,{default:o(()=>[C("Name")]),_:1}),a(b,{id:"user-name",placeholder:"Name","aria-label":"Name","aria-describedby":"basic-addon1"})]),_:1}),a(p,{class:"mb-3"},{default:o(()=>[a(x,null,{default:o(()=>[C("Email")]),_:1}),a(b,{id:"user-email",placeholder:"Email","aria-label":"Email","aria-describedby":"basic-addon1"})]),_:1}),a(P,{"aria-label":"Default select example",class:"mb-3",id:"user-role",modelValue:g.selectedRole,"onUpdate:modelValue":s[8]||(s[8]=l=>g.selectedRole=l)},{default:o(()=>[He,Oe,Xe]),_:1},8,["modelValue"]),g.selectedRole.includes("worker")?(n(),A(P,{key:0,"aria-label":"Default select example",id:"user-job",modelValue:e.createWithSelectedJob,"onUpdate:modelValue":s[9]||(s[9]=l=>e.createWithSelectedJob=l)},{default:o(()=>[(n(!0),v(T,null,W(e.availableJobs,l=>(n(),v("option",{key:l.id,value:l.id},y(l.name),9,Ye))),128))]),_:1},8,["modelValue"])):U("",!0),a(p,{class:"my-3"},{default:o(()=>[a(b,{id:"user-image",type:"file","aria-describedby":"inputGroupFileAddon03","aria-label":"Upload"})]),_:1}),a(p,{class:"mb-3"},{default:o(()=>[a(x,null,{default:o(()=>[C("Password")]),_:1}),a(b,{placeholder:"Password","aria-label":"Password","aria-describedby":"basic-addon1",id:"user-password"})]),_:1})]),_:1},8,["targetId","saveAction"])]),Ze])]),a(M,{targetId:e.modalId+"-edit",title:(R=e.editedUser)==null?void 0:R.name,description:"Edit user",saveAction:e.editUser},{default:o(()=>{var l;return[a(p,{class:"mb-3"},{default:o(()=>{var d;return[a(x,null,{default:o(()=>[$e]),_:1}),a(b,{id:"user-name-edit",placeholder:(d=e.editedUser)==null?void 0:d.name,"aria-label":"Name","aria-describedby":"basic-addon1"},null,8,["placeholder"])]}),_:1}),a(p,{class:"mb-3"},{default:o(()=>{var d;return[a(x,null,{default:o(()=>[C("Email")]),_:1}),a(b,{id:"user-email-edit",placeholder:(d=e.editedUser)==null?void 0:d.email,"aria-label":"Email","aria-describedby":"basic-addon1"},null,8,["placeholder"])]}),_:1}),a(P,{"aria-label":"Default select example",class:"mb-3",id:"user-role-edit",onChange:s[10]||(s[10]=d=>e.editedRole=d.target.value)},{default:o(()=>{var d,J;return[t("option",{value:(d=e.editedUser)==null?void 0:d.role},y((J=e.editedUser)==null?void 0:J.role),9,et),tt,at]}),_:1}),e.editedRole.includes("wo")?(n(),A(P,{key:0,"aria-label":"Default select example",id:"user-job-edit"},{default:o(()=>[t("option",{value:e.editedUser.job.id,default:""},y(e.editedUser.job.name),9,ot),(n(!0),v(T,null,W(e.availableJobs,d=>(n(),v("option",{key:d.id,value:d.id},y(d.name),9,lt))),128))]),_:1})):U("",!0),a(p,{class:"my-3"},{default:o(()=>[a(b,{id:"user-image-edit",type:"file","aria-describedby":"inputGroupFileAddon03","aria-label":"Upload"})]),_:1}),a(p,{class:"mb-3"},{default:o(()=>{var d;return[a(x,null,{default:o(()=>[st]),_:1}),a(b,{type:"password",value:(d=e.editedUser)==null?void 0:d.password,"aria-label":"Password","aria-describedby":"basic-addon1",id:"user-password-edit"},null,8,["value"])]}),_:1}),(l=e.editedUser)!=null&&l.isDeleted?(n(),A(q,{key:1,id:"user-delete-edit",label:"Reactivate user"})):U("",!0)]}),_:1},8,["targetId","title","saveAction"])])])}const mt=oe(re,[["render",rt],["__scopeId","data-v-ede5d702"]]);export{mt as default};
