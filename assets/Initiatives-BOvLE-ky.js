import{A as W,i as _}from"./index-o8w9zVG3.js";import{U as X}from"./UserService-DsiGe4RT.js";import{I as Y}from"./InitiativeService-Cmfvd02_.js";import{S as Z}from"./SuggestionService-CYWNT9ui.js";import{r as I,u as $,_ as ee,l as g,k as e,i as s,w as n,p as P,q as x,F,m as G,f as m,g as l,j as p,t as v,e as A,v as te,x as ae}from"./index-C9Wg4mH0.js";import"./RepositoryInterface-TDgCEybl.js";import"./FoodModelRepository-EukNaaBv.js";import"./SuggestionRepository-CYBXsh7L.js";import"./MaterialRepository-CkyeY5IP.js";const B=new Y,E=new Z,U=new X,oe={components:{AppModal:W},setup(){const f=I([]),i=I(1),S=I(""),t="addinitiative",N=$(),h=I({isDeleted:!1}),w=I(null),b=I(y()[0]??{});function C(o){console.log("Initiative details:",o),N.push(`/initiativeDetails/${o.id}`)}function k(){const o=document.getElementById("initiative-suggestion"),u=Number(o.value[0]);if(!u)return;const D=E.find({id:u});if(!D){_("Suggestion error");return}b.value=D}function L(o){return B.getCalculatedCost(o)}function y(){return E.getAllSuggestions({status:"Pending"})}async function d(){f.value=await B.getAllInitiatives(h.value).filter(o=>S.value.trim()===""?!0:o.local.includes(S.value)||o.id.toString().includes(S.value)).filter((o,u)=>u>=(i.value-1)*10&&u<i.value*10)}async function V(){const o=document.getElementById("initiative-suggestion").value;if(!o){_("Error creating initiative: Suggestion not found",{type:"error"});return}const u=document.getElementById("initiative-local"),D=document.getElementById("initiative-date"),Q=document.getElementById("initiative-duration");if(!u||!D||!Q){_("Error creating initiative: Missing fields",{type:"error"});return}const j=Number(Q.value);if(isNaN(j)){_("Error creating initiative: Duration is not a number",{type:"error"});return}const c=E.find({id:parseInt(o)});if(!c){_("Error creating initiative: Suggestion not found",{type:"error"});return}let K=0;try{const T={createdOn:new Date,date:new Date(D.value),duration:j,eventType:(c==null?void 0:c.eventType)??"food_rescue",local:u.value,isDeleted:!1,id:0,maxParticipants:(c==null?void 0:c.numParticipants)??0,minParticipants:0,status:"pending",sugestionId:(c==null?void 0:c.id)??0};if(K=await B.createInitiative(T).id,c.status!=="Pending"){_("Error creating initiative: Suggestion is not pending",{type:"error"});return}await E.approveSuggestion(Number(o));const J=Math.random().toString(36).slice(-8);await U.findUser({email:c.email})||await U.createUser({email:c.email,password:J,role:"worker",name:c.name,id:0,isDeleted:!1,jobId:0,photoUrl:""}),await d(),_("Initiative created",{type:"success"})}catch(T){K!==0&&B.deleteInitiative(K),_("Error creating initiative: "+T.message,{type:"error"});return}document.getElementById("close-modal-"+t).click()}async function q(o){try{await B.deleteInitiative(o.id)}catch(u){_("Error deleting initiative: "+u.message,{type:"error"});return}await d()}async function a(o){o.orderKey===h.value.orderKey&&(o.orderBy=h.value.orderBy==="asc"?"desc":"asc"),h.value={...h.value,...o},await d()}async function M(o){S.value=o,await d()}async function z(){h.value={isDeleted:!1},await d()}async function O(){i.value++,await d()}async function R(){i.value--,await d()}async function H(o){o<1&&(o=1),i.value=o,await d()}return d(),{modalId:t,initiativeService:B,document,initiatives:f,nextPage:O,previousPage:R,setPage:H,page:i,setQuery:a,resetQuery:z,query:h,getCost:L,setSearch:M,getInitiativeDetails:C,editedInitiative:w,createInitiative:V,getPendingSuggestions:y,defaultSuggestionValues:b,onChangeSuggestion:k,deleteInitiative:q}}},r=f=>(te("data-v-7d0f6eea"),f=f(),ae(),f),ie={class:"intro"},ne={class:"bg-image h-100"},se={class:"mask d-flex align-items-center h-100"},re={class:"container"},le={class:"row justify-content-center"},ce={class:"col-12"},de={class:"d-flex justify-content-between align-items-center mb-3 gap-3"},ue=r(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"})],-1)),ge={class:"card shadow-2-strong"},ve={class:"card-body"},_e={class:"table-responsive"},me={class:"table table-borderless mb-0"},pe={scope:"col"},he=r(()=>e("p",{class:"p-0 m-0"},"Local",-1)),ye=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),fe=[ye],we={scope:"col"},be=r(()=>e("p",{class:"p-0 m-0"},"Event Type",-1)),Ce=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Ie=[Ce],xe=r(()=>e("th",{scope:"col"},"Date",-1)),Be={scope:"col"},Se=r(()=>e("p",{class:"p-0 m-0"},"Id",-1)),ke=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),De=[ke],Pe=r(()=>e("th",{scope:"col"},"Cost",-1)),Ae={scope:"col"},Ee=r(()=>e("p",{class:"p-0 m-0"},"Status",-1)),Le=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Ve=[Le],qe={key:0,scope:"col"},Me=["data-bs-target","onClick"],Ke={class:"custom-row"},Te={class:"custom-row"},Ne={class:"custom-row"},Qe={class:"custom-row"},je={class:"custom-row"},Fe={class:"custom-row"},Ge={key:0,class:"custom-row"},Ue=["data-bs-target","onClick"],ze=r(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x text-white",viewBox:"0 0 16 16"},[e("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"})],-1)),Oe=[ze],Re={class:"container d-flex pt-4 justify-content-between"},He=r(()=>e("span",{"aria-hidden":"true"},"«",-1)),Je=r(()=>e("span",{"aria-hidden":"true"},"»",-1)),We=["value"],Xe=["value"],Ye=r(()=>e("span",{id:"startDateSelected"},null,-1)),Ze=r(()=>e("div",null,null,-1));function $e(f,i,S,t,N,h){const w=m("CInputGroupText"),b=m("CFormInput"),C=m("CInputGroup"),k=m("CButton"),L=m("CButtonGroup"),y=m("CPaginationItem"),d=m("CPagination"),V=m("CFormSelect"),q=m("app-modal");return l(),g("section",ie,[e("div",ne,[e("div",se,[e("main",re,[e("div",le,[e("div",ce,[e("div",de,[s(C,{class:"w-25"},{default:n(()=>[s(w,null,{default:n(()=>[ue]),_:1}),s(b,{onChange:i[0]||(i[0]=a=>t.setSearch(a.target.value)),placeholder:"Search","aria-label":"Search","aria-describedby":"search"})]),_:1}),s(L,{role:"group","aria-label":"Basic example"},{default:n(()=>[s(k,{color:"primary",active:t.query.isDeleted==!1,onClick:i[1]||(i[1]=a=>t.setQuery({isDeleted:!1}))},{default:n(()=>[p("Active")]),_:1},8,["active"]),s(k,{color:"primary",active:t.query.isDeleted==!0,onClick:i[2]||(i[2]=a=>t.setQuery({isDeleted:!0}))},{default:n(()=>[p("Deleted")]),_:1},8,["active"])]),_:1})]),e("div",ge,[e("div",ve,[e("div",_e,[e("table",me,[e("thead",null,[e("tr",null,[e("th",pe,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[3]||(i[3]=a=>t.setQuery({orderKey:"local",orderBy:"asc"}))},[he,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="local"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},fe,4))])]),e("th",we,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[4]||(i[4]=a=>t.setQuery({orderKey:"eventType",orderBy:"asc"}))},[be,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="eventType"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Ie,4))])]),xe,e("th",Be,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[5]||(i[5]=a=>t.setQuery({orderKey:"id",orderBy:"asc"}))},[Se,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="id"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},De,4))])]),Pe,e("th",Ae,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[6]||(i[6]=a=>t.setQuery({orderKey:"status",orderBy:"asc"}))},[Ee,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="status"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Ve,4))])]),t.query.status==="pending"?(l(),g("th",qe,"Delete")):x("",!0)])]),e("tbody",null,[(l(!0),g(F,null,G(t.initiatives,a=>(l(),g("tr",{key:a.id,"data-bs-toggle":"modal","data-bs-target":"#"+t.modalId+"-edit",class:"table-row custom-row-parent",onClick:M=>t.getInitiativeDetails(a)},[e("td",Ke,v(a.local),1),e("td",Te,v(a.eventType),1),e("td",Ne,v(a.date),1),e("td",Qe,v(a.id),1),e("td",je,v(t.getCost(a.id)),1),e("td",Fe,v(a.status),1),a.status==="pending"?(l(),g("td",Ge,[e("button",{type:"button",class:"btn btn-danger btn-sm px-3","data-bs-toggle":"modal","data-bs-target":"#"+t.modalId+"-reject",onClick:M=>t.deleteInitiative(a)},Oe,8,Ue)])):x("",!0)],8,Me))),128))])])])])])])]),e("div",Re,[s(d,{"aria-label":"Page navigation example"},{default:n(()=>[t.page>1?(l(),A(y,{key:0,"aria-label":"Previous",style:{cursor:"pointer"},onClick:t.previousPage},{default:n(()=>[He]),_:1},8,["onClick"])):x("",!0),s(y,{active:""},{default:n(()=>[p(v(t.page),1)]),_:1}),t.initiatives.length==10?(l(),A(y,{key:1,onClick:i[7]||(i[7]=a=>t.setPage(t.page+1)),style:{cursor:"pointer"}},{default:n(()=>[p(v(t.page+1),1)]),_:1})):x("",!0),t.initiatives.length==10?(l(),A(y,{key:2,onClick:i[8]||(i[8]=a=>t.setPage(t.page+2)),style:{cursor:"pointer"}},{default:n(()=>[p(v(t.page+2),1)]),_:1})):x("",!0),t.initiatives.length==10?(l(),A(y,{key:3,"aria-label":"Next",onClick:t.nextPage,style:{cursor:"pointer"}},{default:n(()=>[Je]),_:1},8,["onClick"])):x("",!0)]),_:1}),s(k,{"data-bs-toggle":"modal",type:"button","data-bs-target":"#"+t.modalId,color:"primary"},{default:n(()=>[p(" Add new initiative ")]),_:1},8,["data-bs-target"]),s(q,{targetId:t.modalId,title:"Add Initiative",description:"Create a new initiative",saveAction:t.createInitiative},{default:n(()=>[s(V,{"aria-label":"Default select example",class:"mb-3",id:"initiative-suggestion",onChange:t.onChangeSuggestion},{default:n(()=>[(l(!0),g(F,null,G(t.getPendingSuggestions(),a=>(l(),g("option",{key:a.id,value:a.id},v(a.id)+" - "+v(a.eventName),9,We))),128))]),_:1},8,["onChange"]),s(C,{class:"mb-3"},{default:n(()=>{var a;return[s(w,null,{default:n(()=>[p("Local")]),_:1}),s(b,{id:"initiative-local",value:((a=t.defaultSuggestionValues)==null?void 0:a.local)??"",placeholder:"Local","aria-label":"Local","aria-describedby":"basic-addon1"},null,8,["value"])]}),_:1}),s(C,{class:"mb-3"},{default:n(()=>{var a;return[s(w,null,{default:n(()=>[p("Date")]),_:1}),e("input",{id:"initiative-date",class:"form-control",type:"datetime-local",value:new Date(((a=t.defaultSuggestionValues)==null?void 0:a.date)??0).toISOString().replace("T"," ").substring(0,16)},null,8,Xe),Ye]}),_:1}),s(C,{class:"mb-3"},{default:n(()=>[s(w,null,{default:n(()=>[p("Duration (minutes)")]),_:1}),s(b,{id:"initiative-duration",placeholder:"Duration","aria-label":"Duration","aria-describedby":"basic-addon1"})]),_:1})]),_:1},8,["targetId","saveAction"])]),Ze])])])])}const dt=ee(oe,[["render",$e],["__scopeId","data-v-7d0f6eea"]]);export{dt as default};
