import{A as W}from"./index-D_r6u122.js";import{U as X}from"./UserService-o9p5zFJ_.js";import{i as _}from"./index-xEShUyOC.js";import{I as Y}from"./InitiativeService-DgwwNRpE.js";import{S as Z}from"./SuggestionService-v8Bd-oI4.js";import{b as I,u as $,_ as ee,c as g,a as e,d as s,w as n,T as te,e as m,o as l,f as p,n as P,g as x,F as G,r as j,t as v,h as A,p as ae,i as oe}from"./index-CqBfKhJj.js";import"./RepositoryInterface-TDgCEybl.js";import"./config-Dvl3g2xv.js";import"./FoodModelRepository-EukNaaBv.js";import"./MaterialRepository-CkyeY5IP.js";const B=new Y,E=new Z,U=new X,ie={components:{AppModal:W},setup(){const f=I([]),i=I(1),S=I(""),t="addinitiative",N=$(),h=I({isDeleted:!1}),w=I(null),b=I(y()[0]??{});function C(o){console.log("Initiative details:",o),N.push(`/initiativeDetails/${o.id}`)}function k(){const o=document.getElementById("initiative-suggestion"),u=Number(o.value[0]);if(!u)return;const D=E.find({id:u});if(!D){_("Suggestion error");return}b.value=D}function L(o){return B.getCalculatedCost(o)}function y(){return E.getAllSuggestions({status:"Pending"})}async function d(){f.value=await B.getAllInitiatives(h.value).filter(o=>S.value.trim()===""?!0:o.local.includes(S.value)||o.id.toString().includes(S.value)).filter((o,u)=>u>=(i.value-1)*10&&u<i.value*10)}async function V(){const o=document.getElementById("initiative-suggestion").value;if(!o){_("Error creating initiative: Suggestion not found",{type:"error"});return}const u=document.getElementById("initiative-local"),D=document.getElementById("initiative-date"),Q=document.getElementById("initiative-duration");if(!u||!D||!Q){_("Error creating initiative: Missing fields",{type:"error"});return}const F=Number(Q.value);if(isNaN(F)){_("Error creating initiative: Duration is not a number",{type:"error"});return}const c=E.find({id:parseInt(o)});if(!c){_("Error creating initiative: Suggestion not found",{type:"error"});return}let M=0;try{const K={createdOn:new Date,date:new Date(D.value),duration:F,eventType:(c==null?void 0:c.eventType)??"food_rescue",local:u.value,isDeleted:!1,id:0,maxParticipants:(c==null?void 0:c.numParticipants)??0,minParticipants:0,status:"pending",sugestionId:(c==null?void 0:c.id)??0};if(M=await B.createInitiative(K).id,c.status!=="Pending"){_("Error creating initiative: Suggestion is not pending",{type:"error"});return}await E.approveSuggestion(Number(o));const J=Math.random().toString(36).slice(-8);await U.findUser({email:c.email})||await U.createUser({email:c.email,password:J,role:"worker",name:c.name,id:0,isDeleted:!1,jobId:0,photoUrl:""}),await d(),_("Initiative created",{type:"success"})}catch(K){M!==0&&B.deleteInitiative(M),_("Error creating initiative: "+K.message,{type:"error"});return}document.getElementById("close-modal-"+t).click()}async function T(o){try{await B.deleteInitiative(o.id)}catch(u){_("Error deleting initiative: "+u.message,{type:"error"});return}await d()}async function a(o){o.orderKey===h.value.orderKey&&(o.orderBy=h.value.orderBy==="asc"?"desc":"asc"),h.value={...h.value,...o},await d()}async function q(o){S.value=o,await d()}async function z(){h.value={isDeleted:!1},await d()}async function O(){i.value++,await d()}async function R(){i.value--,await d()}async function H(o){o<1&&(o=1),i.value=o,await d()}return d(),{modalId:t,initiativeService:B,document,initiatives:f,nextPage:O,previousPage:R,setPage:H,page:i,setQuery:a,resetQuery:z,query:h,getCost:L,setSearch:q,getInitiativeDetails:C,editedInitiative:w,createInitiative:V,getPendingSuggestions:y,defaultSuggestionValues:b,onChangeSuggestion:k,deleteInitiative:T}}},r=f=>(ae("data-v-65d6857c"),f=f(),oe(),f),ne={class:"intro"},se={class:"bg-image h-100"},re={class:"mask d-flex align-items-center h-100"},le={class:"container"},ce={class:"row justify-content-center"},de={class:"col-12"},ue={class:"d-flex justify-content-between align-items-center mb-3 gap-3"},ge=r(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"})],-1)),ve={class:"card shadow-2-strong"},_e={class:"card-body"},me={class:"table-responsive"},pe={class:"table table-borderless mb-0"},he={scope:"col"},ye=r(()=>e("p",{class:"p-0 m-0"},"Local",-1)),fe=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),we=[fe],be={scope:"col"},Ce=r(()=>e("p",{class:"p-0 m-0"},"Event Type",-1)),Ie=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),xe=[Ie],Be=r(()=>e("th",{scope:"col"},"Date",-1)),Se={scope:"col"},ke=r(()=>e("p",{class:"p-0 m-0"},"Id",-1)),De=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Pe=[De],Ae=r(()=>e("th",{scope:"col"},"Cost",-1)),Ee={scope:"col"},Le=r(()=>e("p",{class:"p-0 m-0"},"Status",-1)),Ve=r(()=>e("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4"},null,-1)),Te=[Ve],qe={key:0,scope:"col"},Me=["data-bs-target","onClick"],Ke={class:"custom-row"},Ne={class:"custom-row"},Qe={class:"custom-row"},Fe={class:"custom-row"},Ge={class:"custom-row"},je={class:"custom-row"},Ue={key:0,class:"custom-row"},ze=["data-bs-target","onClick"],Oe=r(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x text-white",viewBox:"0 0 16 16"},[e("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"})],-1)),Re=[Oe],He={class:"container d-flex pt-4 justify-content-between"},Je=r(()=>e("span",{"aria-hidden":"true"},"«",-1)),We=r(()=>e("span",{"aria-hidden":"true"},"»",-1)),Xe=["value"],Ye=["value"],Ze=r(()=>e("span",{id:"startDateSelected"},null,-1)),$e=r(()=>e("div",null,null,-1));function et(f,i,S,t,N,h){const w=m("CInputGroupText"),b=m("CFormInput"),C=m("CInputGroup"),k=m("CButton"),L=m("CButtonGroup"),y=m("CPaginationItem"),d=m("CPagination"),V=m("CFormSelect"),T=m("app-modal");return l(),g("section",ne,[e("div",se,[e("div",re,[e("main",le,[e("div",ce,[e("div",de,[e("div",ue,[s(C,{class:"w-25"},{default:n(()=>[s(w,null,{default:n(()=>[ge]),_:1}),s(b,{onChange:i[0]||(i[0]=a=>t.setSearch(a.target.value)),placeholder:"Search","aria-label":"Search","aria-describedby":"search"})]),_:1}),s(L,{role:"group","aria-label":"Basic example"},{default:n(()=>[s(k,{color:"primary",active:t.query.isDeleted==!1,onClick:i[1]||(i[1]=a=>t.setQuery({isDeleted:!1}))},{default:n(()=>[p("Active")]),_:1},8,["active"]),s(k,{color:"primary",active:t.query.isDeleted==!0,onClick:i[2]||(i[2]=a=>t.setQuery({isDeleted:!0}))},{default:n(()=>[p("Deleted")]),_:1},8,["active"])]),_:1})]),e("div",ve,[e("div",_e,[e("div",me,[s(te,{name:"fade"},{default:n(()=>[e("table",pe,[e("thead",null,[e("tr",null,[e("th",he,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[3]||(i[3]=a=>t.setQuery({orderKey:"local",orderBy:"asc"}))},[ye,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="local"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},we,4))])]),e("th",be,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[4]||(i[4]=a=>t.setQuery({orderKey:"eventType",orderBy:"asc"}))},[Ce,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="eventType"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},xe,4))])]),Be,e("th",Se,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[5]||(i[5]=a=>t.setQuery({orderKey:"id",orderBy:"asc"}))},[ke,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="id"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Pe,4))])]),Ae,e("th",Ee,[e("div",{class:"d-flex align-items-center gap-2",style:{cursor:"pointer"},onClick:i[6]||(i[6]=a=>t.setQuery({orderKey:"status",orderBy:"asc"}))},[Le,(l(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16",style:P({transform:t.query.orderKey==="status"&&t.query.orderBy==="asc"?"rotate(180deg)":"rotate(0deg)"})},Te,4))])]),t.query.status==="pending"?(l(),g("th",qe,"Delete")):x("",!0)])]),e("tbody",null,[(l(!0),g(G,null,j(t.initiatives,a=>(l(),g("tr",{key:a.id,"data-bs-toggle":"modal","data-bs-target":"#"+t.modalId+"-edit",class:"table-row custom-row-parent",onClick:q=>t.getInitiativeDetails(a)},[e("td",Ke,v(a.local),1),e("td",Ne,v(a.eventType),1),e("td",Qe,v(a.date),1),e("td",Fe,v(a.id),1),e("td",Ge,v(t.getCost(a.id)),1),e("td",je,v(a.status),1),a.status==="pending"?(l(),g("td",Ue,[e("button",{type:"button",class:"btn btn-danger btn-sm px-3","data-bs-toggle":"modal","data-bs-target":"#"+t.modalId+"-reject",onClick:q=>t.deleteInitiative(a)},Re,8,ze)])):x("",!0)],8,Me))),128))])])]),_:1})])])])])]),e("div",He,[s(d,{"aria-label":"Page navigation example"},{default:n(()=>[t.page>1?(l(),A(y,{key:0,"aria-label":"Previous",style:{cursor:"pointer"},onClick:t.previousPage},{default:n(()=>[Je]),_:1},8,["onClick"])):x("",!0),s(y,{active:""},{default:n(()=>[p(v(t.page),1)]),_:1}),t.initiatives.length==10?(l(),A(y,{key:1,onClick:i[7]||(i[7]=a=>t.setPage(t.page+1)),style:{cursor:"pointer"}},{default:n(()=>[p(v(t.page+1),1)]),_:1})):x("",!0),t.initiatives.length==10?(l(),A(y,{key:2,onClick:i[8]||(i[8]=a=>t.setPage(t.page+2)),style:{cursor:"pointer"}},{default:n(()=>[p(v(t.page+2),1)]),_:1})):x("",!0),t.initiatives.length==10?(l(),A(y,{key:3,"aria-label":"Next",onClick:t.nextPage,style:{cursor:"pointer"}},{default:n(()=>[We]),_:1},8,["onClick"])):x("",!0)]),_:1}),s(k,{"data-bs-toggle":"modal",type:"button","data-bs-target":"#"+t.modalId,color:"primary"},{default:n(()=>[p(" Add new initiative ")]),_:1},8,["data-bs-target"]),s(T,{targetId:t.modalId,title:"Add Initiative",description:"Create a new initiative",saveAction:t.createInitiative},{default:n(()=>[s(V,{"aria-label":"Default select example",class:"mb-3",id:"initiative-suggestion",onChange:t.onChangeSuggestion},{default:n(()=>[(l(!0),g(G,null,j(t.getPendingSuggestions(),a=>(l(),g("option",{key:a.id,value:a.id},v(a.id)+" - "+v(a.eventName),9,Xe))),128))]),_:1},8,["onChange"]),s(C,{class:"mb-3"},{default:n(()=>{var a;return[s(w,null,{default:n(()=>[p("Local")]),_:1}),s(b,{id:"initiative-local",value:((a=t.defaultSuggestionValues)==null?void 0:a.local)??"",placeholder:"Local","aria-label":"Local","aria-describedby":"basic-addon1"},null,8,["value"])]}),_:1}),s(C,{class:"mb-3"},{default:n(()=>{var a;return[s(w,null,{default:n(()=>[p("Date")]),_:1}),e("input",{id:"initiative-date",class:"form-control",type:"datetime-local",value:new Date(((a=t.defaultSuggestionValues)==null?void 0:a.date)??0).toISOString().replace("T"," ").substring(0,16)},null,8,Ye),Ze]}),_:1}),s(C,{class:"mb-3"},{default:n(()=>[s(w,null,{default:n(()=>[p("Duration (minutes)")]),_:1}),s(b,{id:"initiative-duration",placeholder:"Duration","aria-label":"Duration","aria-describedby":"basic-addon1"})]),_:1})]),_:1},8,["targetId","saveAction"])]),$e])])])])}const gt=ee(ie,[["render",et],["__scopeId","data-v-65d6857c"]]);export{gt as default};
